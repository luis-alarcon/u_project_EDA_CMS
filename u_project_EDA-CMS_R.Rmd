---
title: "
"
output: html_notebook
---

Consumer Complaint Database
========================================================
An overview of consumer complaint behavior and company responses
-----------------------------------------------------------------
By Luis Alarcon
----------------

# Disclaimer

<p>I endeavour in this project out of my own volition. It is the first time that I come in contact with this data. I carry no bias before carrying this Exploratory Data Analysis, and the primary goal is to further my knowledge in the methods as well as an understanding of different areas through data analysis.<p>

# Abstract



# Introduction
## Dataset General Information

<p>The full name of the data set is "Inpatient Prospective Payment System (IPPS) Provider Summary for the Top 100 Diagnosis-Related Groups (DRG) - FY2011". It is own and updated by CMS.</p>

<p>The last update was on May 29, 2014, and the metadata was updated on August 30, 2017. For access to the data set as well as further information, please go to this link.</p>

## Dataset Contents

<p>The Dataset has 12 columns. These are the names and the description of them:</p>
<h7><b>This information it is copied straight from the pdf attachment found in this <a href = "https://data.cms.gov/api/views/97k6-zzx3/files/4496fc4f-5f10-43e4-8183-b6da867f8981?download=true&filename=Medicare_Hospital_Inpatient_PUF_Methodology_2017-08-30.pdf">link</a>.</b></h7>
<ol>

<li><b>DRG Definition</b></li>
    The code and description identifying the MS-DRG. MS-DRGs are a classification system that groups similar clinical conditions (diagnoses) and the procedures furnished by the hospital during the stay.
<li><b>Provider Id</b></li>
    The CMS Certification Number (CCN) assigned to the Medicare certified hospital facility.
<li><b>Provider Name</b></li>
    The name of the provider.
<li><b>Provider Street Address</b></li>
    The provider’s street address.
<li><b>Provider City</b></li>
    The city where the provider is located.
<li><b>Provider State</b></li>
    The state where the provider is located.
<li><b>Provider Zip Code</b></li>
    The provider’s zip code.
<li><b>Provider HRR</b></li>
    The Hospital Referral Region (HRR) where the provider is located.
<li><b>Total Discharges</b></li>
    The number of discharges billed by the provider for inpatient hospital services.
<li><b>Average Covered Charges</b></li>
    The provider's average charge for services covered by Medicare for all discharges in the MS-DRG. These will vary from hospital to hospital because of differences in hospital charge structures.
<li><b>Average Total Payments</b></li>
    The average total payments to all providers for the MS-DRG including the MS-DRG amount, teaching, disproportionate share, capital, and outlier payments for all cases. Also included in average total payments are co-payment and deductible amounts that the patient is responsible for and any additional payments by third parties for coordination of benefits.
<li><b>Average Medicare Payments</b></li>
    The average amount that Medicare pays to the provider for Medicare's share of the MS-DRG. Average Medicare payment amounts include the MS-DRG amount, teaching, disproportionate share, capital, and outlier payments for all cases. Medicare payments DO NOT include beneficiary co-payments and deductible amounts norany additional payments from third parties for coordination of benefits. Note: In general, Medicare FFS claims with dates-of-service or dates-of-discharge on or after April 1, 2013, incurred a 2 percent reduction in Medicare payment. This is in response to mandatory across-the-board reductions in Federal spending, also known as sequestration. For additional information, <a href= "http://www.cms.gov/Outreach-and-Education/Outreach/FFSProvPartProg/Downloads/2013-03-08-standalone.pdf">visit</a>. 
</ol>


# Exploratory Data Analysis (EDA)
## EDA: Initial Data Exploration
### Data Summary

<p>Firstly, we load the packages that we are going to use in this project.</p>
```{r}
library(ggplot2)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)
```

<p>Secondly, we load the dataset from its original location to the data frame df_cms.</p>

```{r}
df_cms <- read.csv("./datasets/df_cms.csv")
head(df_cms)
```

<p>Before we continue, we check if there are any null values within the data frame df_cms.</p>

```{r}
df_null <- df_cms[is.na(df_cms),]

head(df_null)
```

<p>There are no null values in the data frame. Afterwards, we check the number of entries present in this dataset.</p>

```{r}
dim(df_cms)
```

<p>The number of entries is 163065. The number of entries is significant. Therefore, We proceed to make a quick summary of the data.</p>

```{r}
summary(df_cms)
```

<p>Due to the vast array of data and groups found in this particular data frame. We will begin our analysis per regions. We will start with "Census Region" since it encompasses all states within the four central regions of the USA, the divisions within regions, the Federal bank that is in charge of the state as well as the Regions established by the Bureau of Economic Analysis.</p>

### Univariate Plots Section

<p>This graph contains the number of entry per each of the groups mentioned above.</p>

```{r echo=FALSE, Bivariate_Plots,fig.width=13,fig.height=10}
p1 = ggplot(df_cms) + geom_histogram(aes(x = Census.Region, fill = Census.Region), stat = "count") + 
  ggtitle("Number of CMS per Census Region.")+
  scale_x_discrete(breaks = 1:4, labels=c("MIDWEST","NORTHEAST","SOUTH","WEST")) +
  xlab(NULL)

p2 = ggplot(df_cms) + geom_histogram(aes(x = Census.Region.Division, fill = Census.Region.Division), stat = "count") + 
  ggtitle("Number of CMS per Census Region Division.") +
  scale_x_discrete(breaks = 1:9, labels=c("D1","D2","D3","D4","D5","D6","D7","D8","D9")) +
  xlab(NULL)

p3 = ggplot(df_cms) + geom_histogram(aes(x = Federal.Region, fill = Federal.Region), stat = "count") + 
  ggtitle("Number of CMS per Federal Bank Region.")+
  scale_x_discrete(breaks = 1:9, labels=c("REGION_I","REGION_II","REGION_III",
                                          "REGION_IV","REGION_V","REGION_VI","REGION_VII",
                                          "REGION_VIII","REGION_X")) +
  xlab(NULL)

p4 = ggplot(df_cms) + geom_histogram(aes(x = Economic.Analysis.Region, fill = Economic.Analysis.Region), stat = "count") + 
  ggtitle("Number of CMS per Bureau of Economic Analysis Region.")+
  scale_x_discrete(breaks = 1:8, labels=c("D1","D2","D3","D4","D5","D6","D7","D8")) +
  xlab(NULL)

p5 = ggplot(aes(x=Census.Region, fill = Census.Region.Division), data= df_cms, stat = "count")+
  geom_bar()+ 
  ggtitle("Number of CMS per Census Region with the divisions shown.")+
  scale_x_discrete(breaks = 1:4, labels=c("MIDWEST","NORTHEAST","SOUTH","WEST")) +
  xlab(NULL)

grid.arrange(p1, p2, p3, p4, p5, ncol=2)
```

### Univariate Analysis Section

<p>We will start the initial analysis by obtaining the frequency for each one of the variables of the columns:</p> 

<ol>
<li>"Census.Region"</p>
<li>"Census Region Division"</p>
<li>"Federal Region"</p>
<li>"Bureau of Economic Analysis Region"</p>
</ol>

```{r}
library(plyr)

print(count(df_cms, vars = "Census.Region"))

print(count(df_cms, vars = "Census.Region.Division"))

print(count(df_cms, vars = "Federal.Region"))

print(count(df_cms, vars = "Economic.Analysis.Region"))

```

<p>In the Census Region, the region South has the highest account of entries with 67038 and the lowest in the West with 26710. In the Divisions in the Census Region, the Division 5 South Atlantic has the hights entries with 34116, and the lowest in the Division 1 New England.</p>

<p>When considering Regions under the different Federal Banks, Region IV is the one with the highest entry and the region with the lowest entries is Region_XIII with 4283. Lastly, The Rocky Mountain Region of the Bureau of Economic Analysis is the region with the lowest entries in 3926. On the other hand, Southeast is the region with the highest entries with 48468.</p>

<p>Before we continue, we will get the summary of the Total Discharges, Average Covered Charges, Average Total Payments and Average Medicare Payments per Census Region.</p>

```{r}
by(df_cms$Total.Discharges, df_cms$Census.Region, summary)
```


```{r}
by(df_cms$Average.Covered.Charges, df_cms$Census.Region, summary)
```

```{r}
by(df_cms$Average.Total.Payments, df_cms$Census.Region, summary)
```


```{r}
by(df_cms$Average.Medicare.Payments, df_cms$Census.Region, summary)
```

## EDA: Furthe Data Exploration
### Bivariate Plots Section

<p>We will start by analysing the following group of variables together:</p>
<ol>
<li>Average Covered Charges vs Average Medicare Payments: This comparison was chosen because Average Covered Charges are the average charge for services covered by Medicare for all discharges in the-DRG and Average Medicare Payments are the average amount that Medicare pays providers for Medicare's share of the MS-DRG.</li>

<li>Total Discharges vs Average Total Payments: This comparison was chosen because the total discharges account for the number of discharges billed by the provider for inpatient hospital services and the average total payments account for the total the average total payments to all providers for the MS-DRG; including partial coverage by the patient.</li>

<li>Average Total Payments vs Average Medicare Payments.</li>
</ol>

#### Average Covered Charges vs Average Medicare Payments

##### CC-vs-MP:Plots

<p>The first graph that is going to show the whole data from df_cms. The whole data is graphed in this way in order to acquire the whole pattern of the data between the two variables. </p>

```{r echo=FALSE, Bivariate_Plots_Total_CC-vs-MP,fig.width=14,fig.height=11}
ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")
```

<pAs seen on the graph, the majority of the data is under the x-value 250000 and y-value 50000. Due to this the second graph will have the limits mentioned above and also 4 further graphs will be added; the entire data frame data selectively gather under the four census regions of the USA, Midwest, Northeast, South and West.</p>

```{r echo=FALSE, Bivariate_Plots_CR_CC-vs-MP,fig.width=14,fig.height=11}
p1 =ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,250000)

p2 = ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "MIDWEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "blue")+ 
  ggtitle("Midwest Region: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,250000)

p3 = ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "NORTHEAST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "green")+ 
  ggtitle("Northeast: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,250000)

p4 = ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "SOUTH")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "yellow")+ 
  ggtitle("South: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,250000)

p5 = ggplot(aes(x=Average.Covered.Charges, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "WEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "brown")+ 
  ggtitle("West: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,250000)

grid.arrange(p1, p2, p3, p4, p5, ncol=2)
```

##### CC-vs-MP:Analysis

#### Total Discharges vs Average Total Payments

##### TD-vs-TP:Plots

```{r echo=FALSE, Bivariate_Plots_Total_TD-vs-TP,fig.width=14,fig.height=11}
ggplot(aes(x=Total.Discharges, y=Average.Total.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")
```


```{r echo=FALSE, Bivariate_Plots_CR_TD-vs-TP,fig.width=14,fig.height=11}
p1 =ggplot(aes(x=Total.Discharges, y=Average.Total.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")+
  ylim(0,75000)+
  xlim(0,500)

p2 = ggplot(aes(x=Total.Discharges, y=Average.Total.Payments),data=subset(df_cms, Census.Region == "MIDWEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "blue")+ 
  ggtitle("Midwest Region: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,75000)+
  xlim(0,500)

p3 = ggplot(aes(x=Total.Discharges, y=Average.Total.Payments),data=subset(df_cms, Census.Region == "NORTHEAST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "green")+ 
  ggtitle("Northeast: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,75000)+
  xlim(0,500)

p4 = ggplot(aes(x=Total.Discharges, y=Average.Total.Payments),data=subset(df_cms, Census.Region == "SOUTH")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "yellow")+ 
  ggtitle("South: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,75000)+
  xlim(0,500)

p5 = ggplot(aes(x=Total.Discharges, y=Average.Total.Payments),data=subset(df_cms, Census.Region == "WEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "brown")+ 
  ggtitle("West: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,75000)+
  xlim(0,500)

grid.arrange(p1, p2, p3, p4, p5, ncol=2)
```

##### TP-vs-MP:Analysis

#### Average Total Payments vs Average Medicare Payments

##### TP-vs-MP:Plots

```{r echo=FALSE, Bivariate_Plots_Total_TP-vs-MP,fig.width=14,fig.height=11}
ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")
```


```{r echo=FALSE, Bivariate_Plots_CR_TP-vs-MP,fig.width=14,fig.height=11}
p1 =ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments, color=Census.Region),data= df_cms) + 
  geom_point(alpha = 1/5, position = position_jitter(h=0))+ 
  ggtitle("Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,50000)

p2 = ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "MIDWEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "blue")+ 
  ggtitle("Midwest Region: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,50000)

p3 = ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "NORTHEAST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "green")+ 
  ggtitle("Northeast: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,50000)

p4 = ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "SOUTH")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "yellow")+ 
  ggtitle("South: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,50000)

p5 = ggplot(aes(x=Average.Total.Payments, y=Average.Medicare.Payments),data=subset(df_cms, Census.Region == "WEST")) + geom_point(alpha = 1/5, position = position_jitter(h=0), color = "brown")+ 
  ggtitle("West: Average Covered Charges vs Average Medicare Payments")+
  ylim(0,50000)+
  xlim(0,50000)

grid.arrange(p1, p2, p3, p4, p5, ncol=2)
```

##### TP-vs-MP:Analysis

# awd
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
